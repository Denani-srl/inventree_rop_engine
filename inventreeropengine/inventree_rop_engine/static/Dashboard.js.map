{"version":3,"file":"Dashboard.js","sources":["../../frontend/node_modules/@tabler/icons-react/dist/esm/icons/IconShoppingCart.mjs","../../frontend/src/Dashboard.tsx"],"sourcesContent":["/**\n * @license @tabler/icons-react v3.35.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nconst __iconNode = [[\"path\", { \"d\": \"M6 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0\", \"key\": \"svg-0\" }], [\"path\", { \"d\": \"M17 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0\", \"key\": \"svg-1\" }], [\"path\", { \"d\": \"M17 17h-11v-14h-2\", \"key\": \"svg-2\" }], [\"path\", { \"d\": \"M6 5l14 1l-1 7h-13\", \"key\": \"svg-3\" }]];\nconst IconShoppingCart = createReactComponent(\"outline\", \"shopping-cart\", \"ShoppingCart\", __iconNode);\n\nexport { __iconNode, IconShoppingCart as default };\n//# sourceMappingURL=IconShoppingCart.mjs.map\n","\nimport { Alert, Badge, Button, Group, LoadingOverlay, Stack, Table, Text } from '@mantine/core';\nimport { useEffect, useState } from 'react';\nimport { IconAlertTriangle, IconShoppingCart } from '@tabler/icons-react';\n\n// Import for type checking\nimport { checkPluginVersion, type InvenTreePluginContext } from '@inventreedb/ui';\n\ninterface ROPSuggestion {\n    id: number;\n    part_name: string;\n    part_IPN: string;\n    part_url: string;\n    urgency_score: number;\n    current_stock: number;\n    suggested_order_qty: number;\n    days_until_stockout: number | null;\n    supplier_name: string;\n    lead_time_days: number;\n}\n\n/**\n * Render ROP Dashboard Widget showing urgent reorder suggestions\n */\nfunction ROPDashboardWidget({\n    context\n}: {\n    context: InvenTreePluginContext;\n}) {\n    const [suggestions, setSuggestions] = useState<ROPSuggestion[]>([]);\n    const [loading, setLoading] = useState<boolean>(true);\n    const [error, setError] = useState<string | null>(null);\n\n    const apiUrl = context.context?.api_url;\n\n    useEffect(() => {\n        if (!apiUrl) {\n            setError('API URL not configured');\n            setLoading(false);\n            return;\n        }\n\n        // Fetch ROP suggestions from the backend\n        fetch(apiUrl, {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            credentials: 'same-origin'\n        })\n            .then(response => {\n                if (!response.ok) {\n                    throw new Error(`HTTP error! status: ${response.status}`);\n                }\n                return response.json();\n            })\n            .then(data => {\n                setSuggestions(data.results || []);\n                setLoading(false);\n            })\n            .catch(err => {\n                console.error('Error fetching ROP suggestions:', err);\n                setError(`Failed to load suggestions: ${err.message}`);\n                setLoading(false);\n            });\n    }, [apiUrl]);\n\n    const getUrgencyColor = (score: number): string => {\n        if (score >= 80) return 'red';\n        if (score >= 60) return 'orange';\n        if (score >= 40) return 'yellow';\n        return 'green';\n    };\n\n    const formatStockoutDays = (days: number | null) => {\n        if (days === null) return 'Unknown';\n        if (days <= 0) return <Text c=\"red\" fw={700}>NOW</Text>;\n        if (days <= 7) return <Text c=\"orange\" fw={700}>{days} days</Text>;\n        return `${days} days`;\n    };\n\n    if (loading) {\n        return (\n            <div style={{ position: 'relative', minHeight: 200 }}>\n                <LoadingOverlay visible={true} />\n                <Text ta=\"center\" mt=\"xl\">Loading ROP suggestions...</Text>\n            </div>\n        );\n    }\n\n    if (error) {\n        return (\n            <Alert icon={<IconAlertTriangle size=\"1rem\" />} title=\"Error\" color=\"red\">\n                {error}\n            </Alert>\n        );\n    }\n\n    if (suggestions.length === 0) {\n        return (\n            <Alert icon={<IconAlertTriangle size=\"1rem\" />} title=\"All Clear!\" color=\"green\">\n                <Text>No urgent reorder suggestions at this time.</Text>\n            </Alert>\n        );\n    }\n\n    return (\n        <Stack gap=\"md\">\n            <Group justify=\"space-between\">\n                <Text size=\"lg\" fw={700}>\n                    <IconAlertTriangle size=\"1.2rem\" style={{ marginRight: 8, verticalAlign: 'middle' }} />\n                    {suggestions.length} Part{suggestions.length > 1 ? 's' : ''} Requiring Attention\n                </Text>\n            </Group>\n\n            <Table striped highlightOnHover>\n                <Table.Thead>\n                    <Table.Tr>\n                        <Table.Th>Urgency</Table.Th>\n                        <Table.Th>Part</Table.Th>\n                        <Table.Th ta=\"right\">Order Qty</Table.Th>\n                        <Table.Th ta=\"right\">Current</Table.Th>\n                        <Table.Th>Stockout</Table.Th>\n                        <Table.Th>Supplier</Table.Th>\n                        <Table.Th>Action</Table.Th>\n                    </Table.Tr>\n                </Table.Thead>\n                <Table.Tbody>\n                    {suggestions.map((suggestion) => (\n                        <Table.Tr\n                            key={suggestion.id}\n                            style={{ cursor: 'pointer' }}\n                            onClick={() => window.location.href = suggestion.part_url}\n                        >\n                            <Table.Td>\n                                <Badge color={getUrgencyColor(suggestion.urgency_score)}>\n                                    {Math.round(suggestion.urgency_score)}\n                                </Badge>\n                            </Table.Td>\n                            <Table.Td>\n                                <div>\n                                    <Text fw={600}>{suggestion.part_name}</Text>\n                                    <Text size=\"xs\" c=\"dimmed\">{suggestion.part_IPN || 'No IPN'}</Text>\n                                </div>\n                            </Table.Td>\n                            <Table.Td ta=\"right\">\n                                <Text fw={700} c=\"green\">{Math.round(suggestion.suggested_order_qty)}</Text>\n                            </Table.Td>\n                            <Table.Td ta=\"right\">\n                                {Math.round(suggestion.current_stock)}\n                            </Table.Td>\n                            <Table.Td>\n                                {formatStockoutDays(suggestion.days_until_stockout)}\n                            </Table.Td>\n                            <Table.Td>\n                                <div>\n                                    <Text size=\"sm\">{suggestion.supplier_name || 'No supplier'}</Text>\n                                    <Text size=\"xs\" c=\"dimmed\">Lead: {suggestion.lead_time_days || '?'} days</Text>\n                                </div>\n                            </Table.Td>\n                            <Table.Td onClick={(e) => e.stopPropagation()}>\n                                <Button\n                                    size=\"xs\"\n                                    leftSection={<IconShoppingCart size=\"1rem\" />}\n                                    onClick={() => alert('Generate PO functionality coming soon')}\n                                >\n                                    Order\n                                </Button>\n                            </Table.Td>\n                        </Table.Tr>\n                    ))}\n                </Table.Tbody>\n            </Table>\n        </Stack>\n    );\n}\n\n\n// This is the function which is called by InvenTree to render the actual dashboard component\nexport function renderROPDashboardItem(context: InvenTreePluginContext) {\n    checkPluginVersion(context);\n    return <ROPDashboardWidget context={context} />;\n}\n"],"names":["__iconNode","IconShoppingCart","createReactComponent","Alert","useEffect","ROPDashboardWidget","context","suggestions","setSuggestions","useState","loading","setLoading","error","setError","apiUrl","api_url","fetch","method","headers","credentials","then","response","ok","Error","status","json","data","results","catch","err","console","message","getUrgencyColor","score","formatStockoutDays","days","Text","position","minHeight","LoadingOverlay","IconAlertTriangle","length","Stack","Group","marginRight","verticalAlign","Table","map","suggestion","id","cursor","window","location","href","part_url","Badge","urgency_score","Math","round","part_name","part_IPN","suggested_order_qty","current_stock","days_until_stockout","supplier_name","lead_time_days","e","stopPropagation","Button","alert","renderROPDashboardItem","checkPluginVersion"],"mappings":"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","x_google_ignoreList":[0]}